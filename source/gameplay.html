<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<title>Gameplay</title>
		<link rel="stylesheet" href="styles/gameplay.css" />
	</head>

	<body>
		<div id="stage">
			<aside id="scoreboard">
				<section class="card card-goal">
					<p id="current-blind-name">Big Blind</p>
					<p>Score at least</p>
					<h1 id="goal-score">—</h1>
				</section>
				<section class="card card-round">
					<p>Current Round Score</p>
					<h1 id="round-score">—</h1>
				</section>
				<section class="card card-hand-type">
					<p>Hand Type</p>
					<h2 id="current-hand-type">—</h2>
				</section>
				<section class="card card-chips">
					<div class="chip-row">
						<div class="chip red"><span id="chip-val">1</span></div>
						<span class="times">×</span>
						<div class="chip blue"><span id="mult-val">1</span></div>
					</div>
					<p class="chip-label">Chips / Mult</p>
				</section>
				<nav class="actions">
					<button class="btn-pill" id="info">Info</button>
					<button class="btn-pill" id="options">Options</button>
				</nav>
				<div class="bank-balance">$<span id="bank-amount">—</span></div>
				<ul class="stats-list">
					<li>Discards Left: <strong id="discards-left">0</strong></li>
					<li>Hands Left: <strong id="hands-left">0</strong></li>
					<li>Ante: <strong id="current-ante">1</strong></li>
				</ul>
			</aside>

			<main id="board">
				<section id="top-info-bar">
					<hand-element id="jokers-area" class="card-placeholder-area" aria-label="Jokers area" data-card-width="60"> </hand-element>
					<div id="round-status-display" aria-label="Round status"></div>
					<hand-element id="consumables-area" class="card-placeholder-area" aria-label="Consumables area" data-card-width="60"> </hand-element>
				</section>

				<div id="played-cards-container">
					<hand-element id="played-cards-display" aria-label="Played cards area" data-card-width="70"> </hand-element>
				</div>

				<footer id="hand-strip">
					<nav class="player-hand-actions">
						<button class="btn-pill" id="play-selected-cards">Play Selected</button>
						<button class="btn-pill" id="discard-selected-cards">Discard Selected</button>
					</nav>

					<hand-element id="player-hand-cards" aria-label="Player hand cards" data-card-width="80"> </hand-element>

					<div id="deck-area">
						<div id="deck" aria-label="Deck"></div>
						<p id="deck-card-count">0/0</p>
					</div>
				</footer>
			</main>
		</div>

		<script type="module">
			import { HandElement } from "./scripts/frontend/HandElement.js";
			import { DeckElement } from "./scripts/frontend/DeckElement.js";
			import { CardElement } from "./scripts/frontend/CardElement.js";
			import { WebUI } from "./scripts/frontend/WebUI.js";
			import { gameHandler } from "./scripts/backend/gameHandler.js";

			// Wait for DOM to be fully loaded and start the actual game
			async function initializeGame() {
				console.log("Initializing BalatJack game...");

				// Ensure custom elements are defined
				await customElements.whenDefined("hand-element");
				await customElements.whenDefined("card-element");

				console.log("Custom elements defined");

				// Get essential containers to verify they exist
				const deckContainer = document.getElementById("deck");
				const playerHandContainer = document.getElementById("player-hand-cards");

				if (!deckContainer || !playerHandContainer) {
					console.error("Required containers not found");
					return;
				}

				// Initialize the deck UI element (visual deck representation)
				let deckElement = new DeckElement("back", deckContainer);

				// Create the WebUI (connects HTML to game logic)
				const webUI = new WebUI();

				// Create the game handler with our WebUI
				const game = new gameHandler(webUI);

				// The game handler automatically:
				// 1. Creates a standard 52-card deck
				// 2. Deals 5 cards to the player's hand
				// 3. Sets up the initial game state
				// 4. Updates the scorekeeper
				// 5. Enables the play/discard buttons

				console.log("Game initialized successfully!");
				console.log("- Select cards by clicking them");
				console.log("- Use 'Play Selected' to score your hand");
				console.log("- Use 'Discard Selected' to replace unwanted cards");
				console.log("- Goal: Reach", game.state.blindRequirements[0], "points to advance!");
			}

			// Initialize the game when DOM is ready
			if (document.readyState === "loading") {
				document.addEventListener("DOMContentLoaded", initializeGame);
			} else {
				// Add a small delay to ensure everything is ready
				setTimeout(initializeGame, 10);
			}
		</script>
	</body>
</html>

