<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>BalatJack</title>

		<link href="https://fonts.googleapis.com/css2?family=Cardo:wght@700&display=swap" rel="stylesheet" />
		<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue:wght@400&display=swap" rel="stylesheet" />
		<link rel="stylesheet" href="styles.css" />
		<link rel="stylesheet" href="menu.css" />
		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				height: 100%;
				overflow: hidden;
				/* Prevents scrollbars if content slightly overflows */
			}
		</style>
	</head>

	<body>
		<!-- Floating cards background -->
		<img src="./res/img/card/king_heart.png" class="card-decor" style="--rotate: -15deg" />
		<img src="./res/img/card/3_spade.png" class="card-decor" style="--rotate: 10deg" />
		<img src="./res/img/card/5_spade.png" class="card-decor" style="--rotate: -10deg" />
		<img src="./res/img/card/10_heart.png" class="card-decor" style="--rotate: 5deg" />

		<img src="res/img/card/3_heart.png" class="card-decor" style="--rotate: 12deg" />
		<img src="res/img/card/queen_spade.png" class="card-decor" style="--rotate: -8deg" />
		<img src="res/img/card/7_club.png" class="card-decor" style="--rotate: 7deg" />
		<img src="res/img/card/jack_diamond.png" class="card-decor" style="--rotate: -12deg" />

		<!-- Main app content container -->
		<div id="app" class="menu-content"></div>

		<audio id="bg-music" loop autoplay>
			<source src="./res/snd/track2.wav" type="audio/mpeg" />
			Your browser does not support the audio element.
		</audio>

		<script type="module">
			// Available background music tracks
			const musicSources = ["./res/snd/track1.mp3", "./res/snd/track2.mp3"];
			let currentMusicIndex = 1;

			function setContent(html) {
				document.getElementById("app").innerHTML = html;
			}

			/**
			 * Displays the main menu.
			 */
			window.showMainMenu = function () {
				const appDiv = document.getElementById("app");
				// Restore menu-specific class and reset inline styles from game mode
				appDiv.className = "menu-content";
				appDiv.style.width = "";
				appDiv.style.height = "";
				appDiv.style.padding = "";
				appDiv.style.margin = "";

				// Restore visibility of decorative cards
				document.querySelectorAll(".card-decor").forEach((card) => (card.style.display = ""));

				setContent(`
        <div class="main-menu-container">
          <div class="main-menu-title-container">
            <img src="res/img/card/joker/horseshoe.png" alt="Joker Left" class="joker-card joker-left" style="--rotate:-10deg;">
            <h1 class="main-menu-title"> BalatJack </h1>
            <img src="res/img/card/joker/mirror_mask.png" alt="Joker Right" class="joker-card joker-right" style="--rotate:10deg;">
          </div>
          <div class="main-menu-buttons">
            <button class="fancy-btn" onclick="startGame()">Start Game</button>
          </div>
        </div>
      `);
			};

			/**
			 * Starts a new game by loading it into an iframe.
			 */
			window.startGame = function () {
				const appDiv = document.getElementById("app");
				appDiv.innerHTML = ""; // Clear previous content (e.g., start menu)
				appDiv.className = ""; // Remove 'menu-content' or other classes

				// Style #app to be a full-area container for the game iframe
				appDiv.style.width = "100%";
				appDiv.style.height = "100vh"; // Use viewport height
				appDiv.style.padding = "0";
				appDiv.style.margin = "0";
				appDiv.style.overflow = "hidden"; // Prevent scrollbars on #app if iframe is exact fit

				const iframe = document.createElement("iframe");
				iframe.src = "gameplay.html";
				iframe.style.width = "100%";
				iframe.style.height = "100%"; // Iframe fills the re-styled #app
				iframe.style.border = "none";
				iframe.setAttribute("title", "BalatJack Game"); // Accessibility

				appDiv.appendChild(iframe);

				// Hide decorative cards as they might overlap or be distracting
				document.querySelectorAll(".card-decor").forEach((card) => (card.style.display = "none"));
			};

			/**
			 * Returns the array of available music sources.
			 * Callable from iframe: window.parent.getAvailableMusic()
			 */
			window.getAvailableMusic = function () {
				return musicSources;
			};

			/**
			 * Sets the background music source to the track at the given index.
			 * Callable from iframe: window.parent.setMusicSource(index)
			 * @param {number} index - The index of the music track in the musicSources array.
			 */
			window.setMusicSource = function (index) {
				if (index >= 0 && index < musicSources.length) {
					currentMusicIndex = index;
					const audio = document.getElementById("bg-music");
					audio.src = musicSources[index];
					audio.load();
					audio.play().catch((error) => console.error("Audio playback failed for new source:", error));
					localStorage.setItem("preferredMusicIndex", index);
				} else {
					console.error("Invalid music index:", index);
				}
			};

			/**
			 * Enables audio playback when the user interacts with the page.
			 */
			function enableAudioPlayback() {
				const audio = document.getElementById("bg-music");
				audio.play().catch((error) => console.error("Audio playback failed:", error));
				document.removeEventListener("click", enableAudioPlayback);
			}

			// Initialize the page and set up event listeners
			window.onload = () => {
				const preferredIndex = localStorage.getItem("preferredMusicIndex");
				if (preferredIndex !== null) {
					currentMusicIndex = parseInt(preferredIndex, 10);
					const audio = document.getElementById("bg-music");
					if (musicSources[currentMusicIndex]) {
						audio.src = musicSources[currentMusicIndex];
						audio.load();
					}
				}
				document.addEventListener("click", enableAudioPlayback);
				showMainMenu();
			};
		</script>
	</body>
</html>

